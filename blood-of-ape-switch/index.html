<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blood of Ape Switch</title>
    <link id="styles" rel="stylesheet" type="text/css" href="blood-of-ape.css">
</head>
<body>
    <div class="container">
        <button class="logo-button" onclick="toggleImage()">
            <img src="eye.gif" alt="Eyeverse Logo">
        </button>
        <img id="image1" src="https://eyeverse.s3.amazonaws.com/blood-of-ape/1/1.png" alt="Ape Kin">
        <img id="image2" class="hidden" src="https://eyeverse.s3.amazonaws.com/blood-of-ape/2/1.png" alt="Paradox Reflection">
        <img id="image3" class="hidden" src="https://eyeverse.s3.amazonaws.com/blood-of-ape/3/1.png" alt="Evolved Ape">
        <div class="select-box">
            <select id="tokenSelect" onchange="updateImages()">
                <!-- Options will be populated by JS -->
            </select>
        </div>
        <div id="loader" style="display:none; position:absolute; left:50%; top:50%; transform:translate(-50%,-50%); z-index:100;">
            <img src="loader.gif" alt="Loading..." style="width:64px;height:64px;">
        </div>
    </div>
    <script>
    // Populate the select dropdown with options 1-333
    const select = document.getElementById('tokenSelect');
    for (let i = 1; i <= 333; i++) {
        const option = document.createElement('option');
        option.value = i;
        option.textContent = i;
        select.appendChild(option);
    }

    function showLoader() {
        document.getElementById('loader').style.display = 'block';
    }
    function hideLoader() {
        document.getElementById('loader').style.display = 'none';
    }

    // Update images when a new token is selected, with loader
    function updateImages() {
        const n = select.value;
        const img1 = document.getElementById('image1');
        const img2 = document.getElementById('image2');
        const img3 = document.getElementById('image3');
        showLoader();
        let loaded = 0;
        function checkHide() {
            loaded++;
            if (loaded === 3) hideLoader();
        }
        img1.onload = checkHide;
        img2.onload = checkHide;
        img3.onload = checkHide;
        img1.onerror = checkHide;
        img2.onerror = checkHide;
        img3.onerror = checkHide;
        img1.src = `https://eyeverse.s3.amazonaws.com/blood-of-ape/1/${n}.png`;
        img2.src = `https://eyeverse.s3.amazonaws.com/blood-of-ape/2/${n}.png`;
        img3.src = `https://eyeverse.s3.amazonaws.com/blood-of-ape/3/${n}.png`;
    }

    // Enhanced toggleImage function to check if image exists before toggling, with loader
    function toggleImage() {
        const img1 = document.getElementById('image1');
        const img2 = document.getElementById('image2');
        const img3 = document.getElementById('image3');
        const imgs = [img1, img2, img3];
        const current = imgs.findIndex(img => !img.classList.contains('hidden'));
        const next = (current + 1) % imgs.length;
        const targetImg = imgs[next];

        showLoader();
        const testImg = new Image();
        testImg.onload = function() {
            imgs.forEach(img => img.classList.add('hidden'));
            targetImg.classList.remove('hidden');
            hideLoader();
        };
        testImg.onerror = function() {
            hideLoader();
            alert('Image does not exist or failed to load.');
        };
        testImg.src = targetImg.src;
    }
    </script>
    <script src="switch.js"></script>
    <style>
    .select-box {
        position: absolute;
        z-index: 20;
        top: 10px;
        right: 10px;
        background: #1b1b1b;
        border: 1px solid #00624a;
        border-radius: 5%;
        padding: 1.5%;
        box-sizing: border-box;
    }
    </style>
</body>
</html>